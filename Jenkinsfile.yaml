pipeline:
  agent:
    any:

  environment:
    VENV_DIR: "venv"

  stages:
    - stage: "Checkout Code"
      steps:
         - sh "git clone https://github.com/niruk2004/jenkins_new.git ."

    - stage: "Set Up Python Environment"
      steps:
        - sh "python3 -m venv ${VENV_DIR}"
        - sh ". ${VENV_DIR}/bin/activate"
        - sh "pip install --upgrade pip"
        - sh "pip install -r requirements.txt"

    - stage: "Build - Syntax Check"
      steps:
        - sh ". ${VENV_DIR}/bin/activate"
        - sh "python -m py_compile sources/add2vals.py sources/calc.py"

    - stage: "Test"
      steps:
        - sh ". ${VENV_DIR}/bin/activate"
        - sh "mkdir -p test-reports"
        - sh "pytest --verbose --junit-xml=test-reports/results.xml sources/test_calc.py"

    - stage: "Deliver - PyInstaller Build"
      steps:
        - sh ". ${VENV_DIR}/bin/activate"
        - sh "pyinstaller --onefile sources/add2vals.py"


